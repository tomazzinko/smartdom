---
- name: Create Mosquitto directories
  file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - /opt/mosquitto/config
    - /opt/mosquitto/data
    - /opt/mosquitto/log

- name: Configure Mosquitto
  copy:
    dest: /opt/mosquitto/config/mosquitto.conf
    content: |
      persistence true
      persistence_location /mosquitto/data/
      log_dest file /mosquitto/log/mosquitto.log
      password_file /mosquitto/config/passwd
      allow_anonymous false
      listener 1883

- name: Create Mosquitto container
  docker_container:
    name: mosquitto
    image: eclipse-mosquitto:latest
    state: started
    restart_policy: always
    ports:
      - "1883:1883"
    volumes:
      - /opt/mosquitto/config:/mosquitto/config
      - /opt/mosquitto/data:/mosquitto/data
      - /opt/mosquitto/log:/mosquitto/log 